if (self.CavalryLogger) { CavalryLogger.start_js(["ahhl3"]); }

__d("ContentSearchEvents",[],(function a(b,c,d,e,f,g){f.exports={CONTENT_SEARCH:"content_search",OPEN_TRAY:"open_tray",QUERY_RESULTS_LOADED:"query_results_loaded",RESULT_SENT:"result_sent",namesByValue:{content_search:"CONTENT_SEARCH",open_tray:"OPEN_TRAY",query_results_loaded:"QUERY_RESULTS_LOADED",result_sent:"RESULT_SENT"}}}),null);
__d("MessengerPlatformQueryType",[],(function a(b,c,d,e,f,g){f.exports={SEARCH:0,MEDIAFY:1,TRENDING:2,SAMPLE:3,namesByValue:["SEARCH","MEDIAFY","TRENDING","SAMPLE"]}}),null);
__d("XMessengerPlatformContentSearchController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/content_search/",{q:{type:"String",defaultValue:""},qtype:{type:"Enum",defaultValue:0,enumType:0},resume:{type:"String",defaultValue:""},"interface":{type:"Enum",enumType:0}})}),null);
__d("ChatContentSearch",["AsyncRequest","MessengerPlatformQueryType","XMessengerPlatformContentSearchController"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={getContentForQuery:function i(j){var k=j.query,l=j.callback,m=j.resume,n=j.searchInterface,o=c("XMessengerPlatformContentSearchController").getURIBuilder().setString("q",k).setString("resume",m);if(n!=null)o.setEnum("interface",n);var p=new(c("AsyncRequest"))().setURI(o.getURI()).setHandler(l);p.send();return p},getTrending:function i(j,k,l){var m=c("XMessengerPlatformContentSearchController").getURIBuilder().setEnum("qtype",c("MessengerPlatformQueryType").TRENDING).setString("resume",k);if(l!=null)m.setEnum("interface",l);var n=new(c("AsyncRequest"))().setURI(m.getURI()).setHandler(j);n.send();return n}};f.exports=h}),null);
__d("ChatContentSearchResult.react",["cx","AddCommentFlyoutSizeType","Image.react","Keys","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes,l=274,m=308,n=137,o=152;i=babelHelpers.inherits(p,c("React").PureComponent);j=i&&i.prototype;function p(){__p&&__p();var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=j.constructor).call.apply(q,[this].concat(t)),this.$ChatContentSearchResult1=function(v){v.stopPropagation();this.props.onClick(this.props.result)}.bind(this),this.$ChatContentSearchResult2=function(v){if(v.keyCode===c("Keys").RETURN){v.preventDefault();this.props.onClick(this.props.result)}}.bind(this),r}p.isWide=function(q){var r=q.media.preview;return r.width>r.height*1.2};p.getScaledDimensions=function(q,r,s){var t=q.media.preview,u=t.height,v=t.width,w=s?o:n,x=s?m:l,y=(r?x:w)/v;u*=y;v*=y;return{height:u,width:v}};p.prototype.render=function(){var q=p.getScaledDimensions(this.props.result,this.props.isWide,this.props.size==="large");return c("React").createElement(c("Image.react"),{className:"_358"+(this.props.isWide?" _26n6":""),onClick:this.$ChatContentSearchResult1,onKeyDown:this.$ChatContentSearchResult2,src:this.props.src,style:q,tabIndex:"0"})};p.propTypes={isWide:k.bool.isRequired,onClick:k.func.isRequired,result:k.object.isRequired,src:k.string.isRequired,size:k.oneOf(Object.values(c("AddCommentFlyoutSizeType")))};p.defaultProps={size:c("AddCommentFlyoutSizeType").SMALL};f.exports=p}),null);
__d("ChatContentSearchResults.react",["AddCommentFlyoutSizeType","ChatContentSearch","ChatContentSearchResult.react","MercuryConfig","MessengerPlatformInterfaceType","MessengerSpinner.react","ReactComponentWithPureRenderMixin","React","ScrollableArea.react","debounce","emptyFunction"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("React").PropTypes,i={};function j(l){return l.replace(/^httpss/,"https")}var k=c("React").createClass({displayName:"ChatContentSearchResults",_inflightRequest:undefined,_requestResults:c("emptyFunction"),_reset:c("emptyFunction"),_inflightTimeStart:undefined,mixins:[c("ReactComponentWithPureRenderMixin")],propTypes:{onResultsLoaded:h.func,onSelect:h.func.isRequired,query:h.string.isRequired,searchInterface:h.oneOf([c("MessengerPlatformInterfaceType").UNKNOWN_INTERFACE,c("MessengerPlatformInterfaceType").FB_INTERFACE,c("MessengerPlatformInterfaceType").MESSENGER_INTERFACE,c("MessengerPlatformInterfaceType").FB_POST_INTERFACE]),size:h.oneOf(Object.values(c("AddCommentFlyoutSizeType")))},getInitialState:function l(){return{isLoading:false,response:null,results:[]}},getDefaultProps:function l(){return{size:"small"}},componentDidMount:function l(){this._reset=c("debounce")(this._resetImpl,100);this._requestResults=c("debounce")(this._requestResultsImpl,200);this._requestResults()},componentWillUnmount:function l(){this._cancelInflightRequest()},componentWillReceiveProps:function l(m){if(m.query!==this.props.query)this._reset(this._requestResultsImpl)},render:function l(){return c("React").createElement(c("ScrollableArea.react"),{fade:true,onScroll:this._handleScroll,ref:"scrollable"},this._renderResults(),this._renderLoadingIndicator())},_renderLoadingIndicator:function l(){if(!this.state.isLoading)return null;return c("React").createElement("div",{style:{marginTop:this.state.response?"10px":"140px",textAlign:"center"}},c("React").createElement(c("MessengerSpinner.react"),{color:"grey",size:c("MessengerSpinner.react").medium_size}))},_requestResultsImpl:function l(){__p&&__p();this._cancelInflightRequest();this._inflightTimeStart=Date.now();if(this.state.response&&(!this.state.response.resultNextCursor||!this.props.query))return;var m=void 0;this.setState({isLoading:true});if(this.props.query)m=c("ChatContentSearch").getContentForQuery({query:this.props.query,resume:this.state.response?this.state.response.resultNextCursor:undefined,callback:this._handleAsyncResponse,searchInterface:this.props.searchInterface});else m=c("ChatContentSearch").getTrending(this._handleAsyncResponse,this.state.response?this.state.response.resultNextCursor:undefined,this.props.searchInterface);this._inflightRequest=m},_handleAsyncResponse:function l(m){__p&&__p();if(this._inflightRequest===m.request){i=babelHelpers["extends"]({},i,m.payload.attribution);this.setState({isLoading:false,response:m.payload,results:m.payload.resultGroup[0]?this.state.results.concat(m.payload.resultGroup[0].results):this.state.results},function(){if(this._inflightTimeStart){if(this.props.onResultsLoaded)this.props.onResultsLoaded(Date.now()-this._inflightTimeStart);delete this._inflightTimeStart}}.bind(this));delete this._inflightRequest}},_cancelInflightRequest:function l(){this.setState({isLoading:false});if(this._inflightRequest){this._inflightRequest.abort();delete this._inflightRequest;delete this._inflightTimeStart}},_renderResults:function l(){if(!this.state.response||!this.state.results.length)return null;return this.state.results.map(function(m,n){var o=c("ChatContentSearchResult.react").isWide(m);if(!o&&m.platformFBID.toString()!==c("MercuryConfig").MessengerAppID){var p=n-this._getPrevWideIndex(n),q=this._getNextWideIndex(n)-n;o=(p<=1||p%2!==0)&&q<=1}return c("React").createElement(c("ChatContentSearchResult.react"),{isWide:o,key:"result:"+n+":"+m.resultID,onClick:this._handleResultClick,result:m,src:j(m.media.preview.url),size:this.props.size})}.bind(this))},_getPrevWideIndex:function l(m){while(m>0){--m;if(c("ChatContentSearchResult.react").isWide(this.state.results[m]))return m}return m},_getNextWideIndex:function l(m){var n=this.state.results.length;while(m<n-1){++m;if(c("ChatContentSearchResult.react").isWide(this.state.results[m]))return m}return m},_handleResultClick:function l(m){this.props.onSelect(m,i[m.platformFBID])},_handleScroll:function l(){if(this._isScrolledNearBottom()&&!this._inflightRequest)this._requestResults()},_isScrolledNearBottom:function l(){var m=this.refs.scrollable.getArea();return!!(m&&m.distanceToBottom()<=50)},_resetImpl:function l(m){this.setState(this.getInitialState(),m)}});f.exports=k}),null);
__d("ChatContentSearchTrendingIndicator.react",["cx","fbt","ix","Image.react","React"],(function a(b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l;k=babelHelpers.inherits(m,c("React").Component);l=k&&k.prototype;function m(n){l.constructor.call(this,n)}m.prototype.shouldComponentUpdate=function(n){return n.shown!==this.props.shown};m.prototype.render=function(){return this.props.shown?c("React").createElement("div",{className:"_515"},c("React").createElement(c("Image.react"),{src:j("28005")}),i._("Trending")):null};f.exports=m}),null);
__d("ChatContentSearchFlyout.react",["cx","fbt","AddCommentFlyoutSizeType","BanzaiLogger","ContentSearchEvents","ChatContentSearchResults.react","ChatContentSearchTrendingIndicator.react","Keys","MessengerPlatformInterfaceType","MessengerSearchInput.react","React","ReactDOM","MercuryShareAttachmentRenderLocations","UFISearchInput.react","XUITextInput.react"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").PropTypes,m=" ",n=/\s+/g,o=c("MercuryShareAttachmentRenderLocations").COMPOSER,p=c("MercuryShareAttachmentRenderLocations").MESSENGER;j=babelHelpers.inherits(q,c("React").PureComponent);k=j&&j.prototype;function q(){__p&&__p();var r,s;for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=k.constructor).call.apply(r,[this].concat(u)),this.state={query:this.props.query,viewerEnteredText:false},this.$ChatContentSearchFlyout6=function(w){this.setState({query:w.target.value,viewerEnteredText:w.target.value.length>0})}.bind(this),this.$ChatContentSearchFlyout1=function(w){return(w||"").trim().replace(n,m).toLowerCase()},this.$ChatContentSearchFlyout2=function(w){if(w.keyCode===c("Keys").ESC&&this.props.onEscKeyDown)this.props.onEscKeyDown()}.bind(this),this.$ChatContentSearchFlyout5=function(w,x){this.props.onSelect(w,x);c("BanzaiLogger").log("ContentSearchLoggerConfig",{event:c("ContentSearchEvents").RESULT_SENT,query:this.state.query,resultid:w.resultID})}.bind(this),this.$ChatContentSearchFlyout4=function(w){c("BanzaiLogger").log("ContentSearchLoggerConfig",{event:c("ContentSearchEvents").QUERY_RESULTS_LOADED,query:this.state.query,inflighttime:w})}.bind(this),s}q.prototype.componentDidMount=function(){c("BanzaiLogger").log("ContentSearchLoggerConfig",{event:c("ContentSearchEvents").OPEN_TRAY,query:this.state.query});if(this.refs.input)if(this.refs.input.focusInput)this.refs.input.focusInput();else c("ReactDOM").findDOMNode(this.refs.input).focus()};q.prototype.componentWillReceiveProps=function(r){if(!this.state.viewerEnteredText)this.setState({query:r.query})};q.prototype.render=function(){var r=this.$ChatContentSearchFlyout1(this.state.query);return c("React").createElement("div",{className:"_1er4",onKeyDown:this.$ChatContentSearchFlyout2,role:"presentation"},c("React").createElement("div",{className:"_3mtr"},this.$ChatContentSearchFlyout3()),c("React").createElement("div",{className:"_3mts"},c("React").createElement(c("ChatContentSearchResults.react"),{onResultsLoaded:this.$ChatContentSearchFlyout4,onSelect:this.$ChatContentSearchFlyout5,query:r,searchInterface:this.props.searchInterface,size:this.props.size}),c("React").createElement(c("ChatContentSearchTrendingIndicator.react"),{shown:r.length===0})))};q.prototype.$ChatContentSearchFlyout3=function(){var r=this.props.location===p?c("MessengerSearchInput.react"):this.props.location===o?c("UFISearchInput.react"):c("XUITextInput.react");return c("React").createElement(r,{className:"_4qcs",isFocused:true,onClick:function s(t){return t&&t.stopPropagation()},onChange:this.$ChatContentSearchFlyout6,onClear:function(){this.setState({query:"",viewerEnteredText:false})}.bind(this),placeholder:i._("Search GIFs across apps..."),ref:"input",value:this.state.query||""})};q.propTypes={location:l.oneOf(c("MercuryShareAttachmentRenderLocations").getValues()),onEscKeyDown:l.func,onSelect:l.func.isRequired,query:l.string,searchInterface:l.oneOf([c("MessengerPlatformInterfaceType").UNKNOWN_INTERFACE,c("MessengerPlatformInterfaceType").FB_INTERFACE,c("MessengerPlatformInterfaceType").FB_POST_INTERFACE,c("MessengerPlatformInterfaceType").MESSENGER_INTERFACE]),size:l.oneOf(Object.values(c("AddCommentFlyoutSizeType")))};q.defaultProps={size:c("AddCommentFlyoutSizeType").SMALL};f.exports=q}),null);